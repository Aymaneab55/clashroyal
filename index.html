<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="description" content="Get free Fish It rods and coins instantly! Select your favorite items and unlock them for free.">
  <meta name="theme-color" content="#1b8fb8">
  <title>Fish â€” Free Items Generator</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@900&family=Orbitron:wght@900&family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
  /* ===== COLOR SYSTEM (Aquatic) ===== */
  :root {
      --primary: #3ec9f5;
      --primary-strong: #1b8fb8;
      --primary-dark: #116888;
      --bg-0: #031421;
      --bg-1: #072033;
      --bg-2: #0a2a42;
      --bg-3: #0e3553;
      --card: #0a2032;
      --card-border: #154061;
      --text: #e6f4ff;
      --muted: #a9c5d9;
      --shadow: 0 20px 60px rgba(0,0,0,0.45);
      --glow: 0 0 25px rgba(62, 201, 245, 0.28);
      --transition: 0.25s ease;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
  html, body {
      min-height: 100vh;
      font-family: 'Inter', 'Cairo', Arial, sans-serif;
      background:
        radial-gradient(circle at 20% 20%, rgba(62, 201, 245, 0.08), transparent 25%),
        radial-gradient(circle at 80% 10%, rgba(62, 201, 245, 0.06), transparent 28%),
        radial-gradient(circle at 50% 80%, rgba(62, 201, 245, 0.05), transparent 32%),
        linear-gradient(180deg, #0a2a42 0%, #041a2c 55%, #031421 100%);
      color: var(--text);
      overflow-x: hidden;
      touch-action: manipulation;
  }
  body.no-scroll { overflow: hidden; position: fixed; width: 100%; height: 100%; }

  /* Sparkles */
  body::before {
      content: "";
      position: fixed; inset: 0;
      background-image:
        radial-gradient(1px 1px at 10% 20%, rgba(62, 201, 245, 0.35), transparent),
        radial-gradient(1.2px 1.2px at 80% 30%, rgba(62, 201, 245, 0.45), transparent),
        radial-gradient(1px 1px at 30% 70%, rgba(62, 201, 245, 0.30), transparent),
        radial-gradient(1.4px 1.4px at 60% 50%, rgba(62, 201, 245, 0.40), transparent);
      opacity: .9;
      pointer-events: none;
  }

  a { color: inherit; text-decoration: none; }

  .page { max-width: 1200px; margin: 0 auto; padding: 28px 16px 140px; }

  /* HEADER / HERO */
  .hero { display: flex; align-items: center; justify-content: space-between; gap: 14px; margin-bottom: 22px; }
  .brand { display: flex; align-items: center; gap: 12px; }
  .brand img { width: 52px; filter: drop-shadow(0 0 10px rgba(62, 201, 245, 0.55)); }
  .brand-title { display: flex; flex-direction: column; gap: 4px; }
  .brand-title h1 { font-size: 28px; letter-spacing: 0.2px; text-shadow: 0 6px 30px rgba(0, 0, 0, 0.35); }
  .brand-title p { color: var(--muted); font-weight: 600; font-size: 14px; }

  .hero-actions {
      display: flex; align-items: center; gap: 10px;
      flex-wrap: wrap; justify-content: flex-end;
  }
  .btn {
      border: none; border-radius: 10px; padding: 12px 16px;
      font-weight: 800; font-size: 14px; cursor: pointer;
      transition: var(--transition); box-shadow: var(--shadow);
  }
  .btn-primary {
      background: linear-gradient(135deg, #70e1ff, #1b8fb8);
      color: #042032;
      box-shadow: 0 12px 30px rgba(62, 201, 245, 0.45);
  }
  .btn-primary:hover { transform: translateY(-1px) scale(1.01); }
  .btn-ghost {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      color: var(--text);
  }
  .status-badge {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 10px 14px; border-radius: 12px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      font-weight: 800; color: var(--text);
  }
  .status-dot {
      width: 10px; height: 10px;
      background: #4dff88;
      border-radius: 50%;
      box-shadow: 0 0 12px rgba(77, 255, 136, 0.8);
  }

  /* SECTION TITLES */
  .section { margin-top: 26px; }
  .section h2 { font-size: 24px; letter-spacing: 0.3px; text-shadow: 0 10px 34px rgba(0,0,0,0.5); }
  .section small { display: block; margin-top: 6px; color: var(--muted); font-weight: 700; }

  /* CARDS */
  .card-row {
      margin-top: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0));
      padding: 18px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: var(--shadow);
  }
  .items-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr)); /* two by two */
      gap: 14px;
  }
  .item-card {
      background: radial-gradient(circle at 30% 30%, rgba(62,201,245,0.09), rgba(62,201,245,0) 55%), #0a2032;
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 14px 12px 12px;
      display: flex; flex-direction: column; align-items: center; gap: 10px;
      cursor: pointer; position: relative; overflow: hidden;
      transition: var(--transition); box-shadow: var(--glow);
      min-height: 156px;
  }
  .item-card::after {
      content: "";
      position: absolute; inset: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.12), transparent 60%);
      opacity: 0; transition: var(--transition);
  }
  .item-card:hover { transform: translateY(-3px); }
  .item-card:hover::after { opacity: 1; }

  .item-card.selected {
      border-color: #70e1ff;
      box-shadow: 0 0 0 2px rgba(112, 225, 255, 0.15), 0 12px 30px rgba(62, 201, 245, 0.5);
      background: linear-gradient(180deg, rgba(112,225,255,0.12), rgba(62,201,245,0.05)), #0d2940;
  }

  /* Default item images (coins) */
  .item-img {
      width: 70px; height: 70px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      object-fit: cover; background: #0f324b;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.35), 0 10px 24px rgba(0,0,0,0.35);
  }
  /* Rod images: fill width of card, keep aspect via height auto, cap max size */
  #itemsGrid .item-img {
      width: 100%;
      height: auto;
      max-width: 357px;
      max-height: 221px;
      object-fit: cover;
      border-radius: 12px;
  }

  .item-name {
      font-weight: 800; color: var(--text);
      text-align: center; font-size: 15px; letter-spacing: 0.2px;
  }
  .pill {
      position: absolute; top: 10px; right: 10px;
      background: #29d2ff; color: #003247;
      padding: 4px 8px; font-size: 10px; font-weight: 900;
      border-radius: 999px; letter-spacing: 0.5px;
      box-shadow: 0 0 10px rgba(41,210,255,0.4);
  }

  /* Continue Button (fixed) */
  .selection-controls { text-align: center; margin: 18px 0 6px; }
  #continue-btn {
      display: none;
      position: fixed;
      left: 50%; bottom: calc(12px + env(safe-area-inset-bottom));
      transform: translateX(-50%);
      z-index: 2000;
      padding: 14px 28px;
      font-size: 14px; font-weight: 900; letter-spacing: 0.5px;
      text-transform: uppercase;
      color: #cdefff;
      background: linear-gradient(180deg, #0f324b, #0b2538);
      border: 1px solid #1c4a69;
      border-radius: 12px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.35), 0 0 0 1px rgba(255,255,255,0.05);
      transition: var(--transition);
  }
  #continue-btn:hover { color: #fff; transform: translateX(-50%) translateY(-1px); }
  #selection-limit-message {
      display: none;
      color: #7ae8ff;
      font-weight: 800;
      font-size: 0.9em;
  }

  /* Footer */
  footer { text-align: center; padding: 26px 8px; color: #8fb6cc; font-size: 12px; margin-top: 30px; }

  /* Locker + popup */
  .locker-overlay {
      display: none; position: fixed; inset: 0;
      background: rgba(0,0,0,0.9); z-index: 9999;
      justify-content: center; align-items: center;
      padding: 10px; animation: fadeIn 0.4s ease;
      overflow-y: auto; -webkit-overflow-scrolling: touch;
  }
  .locker-box {
      width: 100%; max-width: 360px;
      background: linear-gradient(145deg, rgba(62, 201, 245, 0.18), rgba(23, 118, 158, 0.25));
      backdrop-filter: blur(10px);
      border-radius: 10px; padding: 14px; text-align: center;
      color: #fff; box-shadow: 0 8px 30px rgba(62, 201, 245, 0.35);
      position: relative; border: 2px solid rgba(62, 201, 245, 0.4);
  }
  .close-btn {
      position: absolute; top: 8px; right: 8px;
      font-size: 20px; color: #fff; cursor: pointer;
      transition: all var(--transition);
      width: 26px; height: 26px; display: flex; align-items: center; justify-content: center;
      border-radius: 50%; background: rgba(255,255,255,0.1);
      z-index: 10; line-height: 1;
  }
  .close-btn:hover { background: rgba(255,255,255,0.2); transform: rotate(90deg); }

  .selected-items-preview { display: flex; justify-content: center; gap: 6px; margin: 8px auto 10px; flex-wrap: wrap; }
  .selected-item-preview {
      width: 50px; height: 50px; border-radius: 8px; object-fit: cover;
      border: 2px solid var(--primary-dark);
      box-shadow: 0 0 8px rgba(62, 201, 245, 0.6);
      pointer-events: auto;
  }
  .game-title { font-size: 1.1em; font-weight: 900; color: #fff; margin-bottom: 6px; font-family: 'Cairo', Arial, sans-serif; }
  .secure-badge {
      display: inline-flex; align-items: center; gap: 4px;
      background: rgba(62, 201, 245, 0.18);
      padding: 4px 8px; border-radius: 15px;
      border: 1px solid var(--primary-dark);
      margin-bottom: 8px; font-size: 0.7em;
  }
  .secure-badge i { color: var(--primary-strong); font-size: 0.9em; }
  .instruction-text { color: #fff; font-size: 0.75em; line-height: 1.4; margin-bottom: 8px; font-weight: 600; }
  .instruction-text .highlight { color: var(--primary-strong); font-weight: 900; }
  .note-box {
      background: rgba(62, 201, 245, 0.15);
      border: 1.5px solid var(--primary-dark);
      border-radius: 6px; padding: 6px 8px; margin: 8px 0; text-align: left;
  }
  .note-box strong { color: var(--primary-strong); font-size: 0.75em; }
  .note-box p { color: #cdefff; font-size: 0.7em; margin-top: 3px; line-height: 1.3; }
  .offers-prompt { color: #fff; font-size: 0.85em; font-weight: 700; margin: 12px 0 8px; text-align: left; }
  .offers-list { display: flex; flex-direction: column; gap: 8px; }
  .offer-button {
      background: linear-gradient(135deg, var(--primary-dark), #136f92);
      border: none; border-radius: 8px; padding: 10px 12px;
      display: flex; align-items: center; gap: 10px; cursor: pointer;
      transition: all var(--transition); text-align: left;
      box-shadow: 0 3px 8px rgba(62, 201, 245, 0.35); width: 100%;
  }
  .offer-button:hover {
      background: linear-gradient(135deg, #3ec9f5, var(--primary-dark));
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(62, 201, 245, 0.55);
  }
  .offer-button:active { transform: translateY(0); }
  .offer-icon { width: 35px; height: 35px; border-radius: 6px; object-fit: cover; flex-shrink: 0; background: #fff; padding: 3px; pointer-events: auto; }
  .offer-text { flex: 1; color: #002335; font-weight: 800; font-size: 0.8em; line-height: 1.2; }

  .purchase-popup {
      display: none; position: fixed; top:0; left:0; width:100%; height:100%;
      background-color: rgba(0, 0, 0, 0.9); z-index: 1000;
      justify-content: center; align-items: center; animation: fadeIn 0.3s ease;
  }
  .popup-content {
      background: linear-gradient(145deg, #16405a, #0f2f46);
      padding: 15px; border-radius: 12px;
      width: 90%; max-width: 300px; box-shadow: var(--shadow);
      text-align: center; color: white; margin: auto; position: relative;
      animation: scaleIn 0.3s ease;
  }
  .popup-header { position: relative; padding-bottom: 12px; margin-bottom: 12px; }
  .popup-header h3 { font-size: 18px; margin: 0; color: white; font-weight: 700; }
  .popup-header::after {
      content: ''; position: absolute; bottom: 0; left: 10%; right: 10%; height: 2px;
      background: linear-gradient(to right, transparent, #70e1ff, transparent);
  }
  .selected-images-container { display: flex; justify-content: center; align-items: center; gap: 8px; margin: 12px auto; flex-wrap: wrap; }
  .item-popup-image-small {
      width: 50px; height: 50px; border-radius: 50%; object-fit: cover;
      border: 2px solid #70e1ff; box-shadow: var(--shadow-sm); pointer-events: auto;
  }
  .item-confirm { font-size: 14px; margin: 12px 0; color: white; font-weight: 700; line-length: 1.3; }
  .input-group { margin-bottom: 15px; text-align: left; }
  .input-group input {
      width: 100%; padding: 12px; background-color: white; color: #333;
      border: 2px solid #ddd; border-radius: 6px; font-size: 13px; font-weight: 600; transition: all var(--transition);
  }
  .input-group input:focus { outline: none; border-color: #70e1ff; box-shadow: 0 0 0 3px rgba(112, 225, 255, 0.2); }
  .input-group input::placeholder { color: #999; font-weight: 700; }
  .popup-buttons { display: flex; justify-content: space-between; gap: 8px; }
  .cancel-btn {
      background: linear-gradient(135deg, #406a84, #2a4c64);
      color: white; border: none; padding: 12px; border-radius: 6px;
      font-weight: bold; cursor: pointer; flex: 1; font-size: 13px; transition: all var(--transition);
  }
  .cancel-btn:hover { background: linear-gradient(135deg, #4f7d9b, #315a76); }
  .free-btn {
      background: linear-gradient(135deg, white, #e8f7ff);
      border: none; padding: 12px; border-radius: 6px; cursor: pointer;
      flex: 1; display: flex; justify-content: center; align-items: center; gap: 5px;
      transition: all var(--transition); box-shadow: var(--shadow-sm);
  }
  .free-btn:hover { background: linear-gradient(135deg, #e8f7ff, white); transform: translateY(-1px); box-shadow: var(--shadow-md); }
  .free-btn .free-badge { color: #0e3b52; font-weight: 900; display: flex; align-items: center; font-size: 13px; }
  .free-btn .free-icon {
      width: 16px; height: 16px;
      background-image: url('https://tse4.mm.bing.net/th?id=OIP.AZtpRYaMROCrDtdpzAYzvgHaH5&pid=Api&P=0&h=180');
      background-size: contain; background-repeat: no-repeat;
  }
  .folding { margin: 15px auto; width: 60px; height: 60px; position: relative; transform: rotateZ(45deg); }
  .square { position: absolute; top: 30%; right: 30%; width: 25px; height: 25px; background-color: #000; transform: rotateZ(87deg); }
  .folding .sk-cube { float: left; width: 50%; height: 50%; position: relative; transform: scale(1.1); }
  .folding .sk-cube::before {
      content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background-color: #fff; animation: sk-foldCubeAngle 2.4s infinite linear both; transform-origin: 100% 100%;
  }
  .folding .sk-cube2 { transform: scale(1.1) rotateZ(90deg); }
  .folding .sk-cube3 { transform: scale(1.1) rotateZ(180deg); }
  .folding .sk-cube4 { transform: scale(1.1) rotateZ(270deg); }
  .folding .sk-cube2::before { animation-delay: 0.3s; }
  .folding .sk-cube3::before { animation-delay: 0.6s; }
  .folding .sk-cube4::before { animation-delay: 0.9s; }
  @keyframes sk-foldCubeAngle {
      0%, 10% { transform: perspective(140px) rotateX(-180deg); opacity: 0; }
      25%, 75% { transform: perspective(140px) rotateX(0deg); opacity: 1; }
      90%, 100% { transform: perspective(140px) rotateY(180deg); opacity: 0; }
  }
  .searching-text { color: white; font-size: 16px; margin-top: 15px; }
  .result-username { color: white; font-size: 16px; font-weight: bold; margin: 12px 0; }
  .get-item-now-btn {
      background: linear-gradient(135deg, white, #e8f7ff);
      color: #0e3b52; border: none; padding: 12px; border-radius: 6px;
      font-weight: bold; cursor: pointer; width: 100%; font-size: 14px;
      margin-top: 12px; transition: all var(--transition);
  }
  .get-item-now-btn:hover { background: linear-gradient(135deg, #e8f7ff, white); transform: translateY(-1px); box-shadow: var(--shadow-md); }
  .d-none { display: none !important; }
  .user-error { color: #ff9fb3; font-size: 12px; margin-top: 5px; text-align: center; animation: shake 0.5s ease; }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes scaleIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
  @keyframes shake { 0%,100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

  /* Mobile tweaks */
  @media (max-width: 720px) {
      .hero { flex-direction: column; align-items: flex-start; }
      .hero-actions { width: 100%; justify-content: flex-start; }
      .items-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; } /* force 2 columns on mobile */
      .item-card { min-height: 180px; padding: 12px; }
      .item-img { width: 64px; height: 64px; }
      #itemsGrid .item-img { width: 100%; max-width: 240px; max-height: 160px; }
      .brand-title h1 { font-size: 24px; }
  }
  </style>
</head>
<body>

<div class="page">
  <header class="hero">
      <div class="brand">
          <img src="https://i.postimg.cc/VvrDZYxm/Design-sans-titre-(2).png" alt="Fish It Logo" id="header-logo">
          <div class="brand-title">
              <h1>Fish It â€” Rods & Coins</h1>
              <p>Hook premium rods and pile up coins. Pick your boosts and start your fishing sprint.</p>
          </div>
      </div>
      <div class="hero-actions">
          <button class="btn btn-primary">ðŸŽ£ Start Fishing</button>
          <button class="btn btn-ghost">How it works</button>
          <div class="status-badge">
              <span class="status-dot"></span>
              <span id="activeUsersCount">840 Anglers Online</span>
          </div>
      </div>
  </header>

  <!-- Section 1: Coins -->
  <section class="section">
      <h2>1. Select Coins Amount</h2>
      <small>Choose your desired rewards</small>
      <div class="card-row">
          <div class="items-grid" id="moneyGrid">
              <div class="item-card">
                  <img class="item-img" alt="25k Coins" src="https://i.postimg.cc/VNMzRbQf/Currency_(1).webp">
                  <div class="item-name">25k Coins</div>
              </div>
              <div class="item-card">
                  <span class="pill">BEST VALUE</span>
                  <img class="item-img" alt="50k Coins" src="https://i.postimg.cc/VNMzRbQf/Currency_(1).webp">
                  <div class="item-name">50k Coins</div>
              </div>
              <div class="item-card">
                  <img class="item-img" alt="250k Coins" src="https://i.postimg.cc/VNMzRbQf/Currency_(1).webp">
                  <div class="item-name">250k Coins</div>
              </div>
              <div class="item-card">
                  <img class="item-img" alt="1M Coins" src="https://i.postimg.cc/VNMzRbQf/Currency_(1).webp">
                  <div class="item-name">1M Coins</div>
              </div>
          </div>
      </div>
  </section>

  <!-- Section 2: Rods -->
  <section class="section">
      <h2>2. Select Your Rods</h2>
      <small>Choose up to three rods</small>
      <div class="card-row">
          <div class="items-grid" id="itemsGrid">
              <div class="item-card">
                  <img alt="Candy Cane Trident" class="item-img" src="https://i.postimg.cc/pX74QSny/Razorella.png">
                  <div class="item-name">Razorella</div>
              </div>
              <div class="item-card">
                  <img alt="Gingerbread Sword" class="item-img" src="https://i.postimg.cc/KzqJGKPn/Free-Spirit-Rod.webp">
                  <div class="item-name">Free Spirit Rod</div>
              </div>
              <div class="item-card">
                  <img alt="Ornament Axe" class="item-img" src="https://i.postimg.cc/m2t220GK/475px-Wind-Elemental.webp">
                  <div class="item-name">Wind Elemental</div>
              </div>
              <div class="item-card">
                  <img alt="Abyssal Pike" class="item-img" src="https://i.postimg.cc/tTr3HLhk/Screenshot-2026-01-10-145015.png">
                  <div class="item-name">DAVE Rod </div>
              </div>
              <div class="item-card">
                  <img alt="Aurora Line" class="item-img" src="https://i.postimg.cc/vB7KKqs7/5.png">
                  <div class="item-name">Xmas Tree Rod</div>
              </div>
          </div>
      </div>
  </section>

  <div class="selection-controls">
      <div id="selection-limit-message">You can only select up to 3 items.</div>
  </div>
  <div class="selection-controls">
      <button id="continue-btn">Continue â†’</button>
  </div>

  <footer>
      <p>Â© 2025 Fish It Landing Page. All rights reserved.</p>
      <p>Unauthorized copying or distribution is prohibited.</p>
  </footer>
</div>

<!-- PURCHASE POPUP -->
<div class="purchase-popup" id="purchase-popup">
    <div class="popup-content"></div>
</div>

<!-- LOCKER OVERLAY -->
<div id="locker" class="locker-overlay">
    <div class="locker-box">
        <span class="close-btn" onclick="closeLocker()" aria-label="Close">Ã—</span>
        <div class="selected-items-preview" id="selectedItemsPreview"></div>
        <h2 class="game-title">Fish It</h2>
        <div class="secure-badge">
            <i class="fas fa-shield-alt"></i>
            <span>Secure items from bots</span>
        </div>
        <p class="instruction-text">
            Choose one offer below. Complete the task and your items will be claimed <span class="highlight">automatically</span>.
        </p>
        <div class="note-box">
            <strong>NOTE:</strong>
            <p>If an offer doesn't open, try another. Complete the offer exactly to receive your items.</p>
        </div>
        <div class="offers-prompt">Choose an offer below:</div>
        <div class="offers-list" id="offersList">
            <div style="color: #fff; text-align: center; padding: 15px; font-size: 0.75em;">Loading offers...</div>
        </div>
    </div>
</div>

<audio id="dingSound" preload="auto">
    <source src="https://cdn.pixabay.com/audio/2022/03/10/audio_63c49c13c8.mp3" type="audio/mpeg">
</audio>
<audio id="clickSound" preload="auto">
    <source src="https://cdn.pixabay.com/audio/2022/03/10/audio_63c49c13c8.mp3" type="audio/mpeg">
</audio>

<script>
/* ===== CONFIGURATION ===== */
const COIN_IMG_URL = "https://i.postimg.cc/VNMzRbQf/Currency_(1).webp";
const CONFIG = {
    API_KEY: "3b17a09c1ca2bba2d52ffadab4894374",
    USER_ID: "504359",
    API_URL: "https://d1y3y09sav47f5.cloudfront.net/public/offers/feed.php",
    MAX_SELECTIONS: 3,
    ACTIVE_USERS_INTERVAL: 4500
};

/* ===== STATE MANAGEMENT ===== */
const State = { popupOpen: false, selectedItems: [] };

/* ===== UTILITY FUNCTIONS ===== */
const Utils = {
    randomUsers: () => Math.floor(Math.random() * (900 - 90 + 1)) + 90,
    playSound: (soundId) => {
        const sound = document.getElementById(soundId);
        if (sound) { sound.currentTime = 0; sound.play().catch(() => {}); }
    },
    escapeHtml: (text) => { const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }
};

/* ==== LIGHT PROTECTION ==== */
document.addEventListener('contextmenu', e => { e.preventDefault(); return false; });
document.addEventListener('keydown', function(e) {
    if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) || (e.ctrlKey && e.key === 'U')) {
        e.preventDefault(); return false;
    }
});
console.log('%câš ï¸ STOP!', 'color: #3ec9f5; font-size: 50px; font-weight: bold;');
console.log('%cThis is a browser feature intended for developers. If someone told you to copy-paste something here, it is a scam and will give them access to your account.', 'color: #3ec9f5; font-size: 16px;');
console.log('%cÂ© 2025 Fish It Landing Page. All rights reserved. Unauthorized copying is prohibited.', 'color: #1b8fb8; font-size: 14px;');

/* ===== ACTIVE USERS ===== */
function updateActiveUsers() {
    const countElement = document.getElementById('activeUsersCount');
    if (countElement) { countElement.textContent = Utils.randomUsers() + " Anglers Online"; }
}
updateActiveUsers();
setInterval(updateActiveUsers, CONFIG.ACTIVE_USERS_INTERVAL);

/* ===== LOCKER SYSTEM ===== */
const LockerSystem = {
    open: function(username, itemName, itemImages) {
        State.popupOpen = true;
        document.body.classList.add('no-scroll');
        const continueBtn = document.getElementById('continue-btn');
        if (continueBtn) { continueBtn.style.display = 'none'; }
        const locker = document.getElementById("locker");
        if (locker) { locker.style.display = "flex"; }
        const selectedItemsPreview = document.getElementById("selectedItemsPreview");
        if (selectedItemsPreview) {
            selectedItemsPreview.innerHTML = '';
            itemImages.forEach(imgSrc => {
                const img = document.createElement('img');
                img.src = imgSrc; img.className = 'selected-item-preview'; img.alt = 'Selected Item';
                selectedItemsPreview.appendChild(img);
            });
        }
        this.loadOffers();
    },
    loadOffers: function() {
        const offersList = document.getElementById("offersList");
        if (!offersList) return;
        offersList.innerHTML = "<div style='color: #fff; text-align: center; padding: 15px; font-size: 0.75em;'>Loading offers...</div>";
        const apiUrl = `${CONFIG.API_URL}?user_id=${CONFIG.USER_ID}&api_key=${CONFIG.API_KEY}&s1=fish%20it&s2=`;
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 10000);
        fetch(apiUrl, { signal: controller.signal })
        .then(res => res.json())
        .then(offers => {
            clearTimeout(timeoutId);
            if (!offers || !Array.isArray(offers) || offers.length === 0) { this.showFallbackOffers(); return; }
            this.displayOffers(offers);
        })
        .catch((error) => {
            clearTimeout(timeoutId);
            console.log('Error loading offers:', error);
            this.showFallbackOffers();
        });
    },
    showFallbackOffers: function() {
        const fallbackOffers = [
            { anchor: "Complete Quick Survey (1-2 minutes)", url: "#", network_icon: "https://cdn.affise.com/affise-media-service-prod/offers/959/30554/541589117.200x200.jpeg" },
            { anchor: "Watch Short Video Ad (45-60 seconds)", url: "#", network_icon: "https://banners.hangmyads.com/files/uploads/Off_A_101022.png" },
            { anchor: "Free App Trial (2-3 minutes)", url: "#", network_icon: "https://cdn.affise.com/affise-media-service-prod/offers/959/25459/1278432017.200x200.png" }
        ];
        this.displayOffers(fallbackOffers);
    },
    displayOffers: function(offers) {
        const offersList = document.getElementById("offersList");
        if (!offersList) return;
        let html = "";
        offers.slice(0, 2).forEach((offer) => {
            const offerTitle = offer.anchor || offer.name || "Complete Offer";
            const offerUrl = offer.url || "#";
            const offerIcon = offer.network_icon || "https://via.placeholder.com/40";
            html += `
                <button class="offer-button" onclick="LockerSystem.selectOffer('${offerUrl.replace(/'/g, "\\'")}', '${Utils.escapeHtml(offerTitle).replace(/'/g, "\\'")}')">
                    <img src="${offerIcon}" alt="Offer" class="offer-icon" onerror="this.src='https://via.placeholder.com/40'">
                    <span class="offer-text">${Utils.escapeHtml(offerTitle)}</span>
                </button>
            `;
        });
        if (html === "") {
            html = "<div style='color: #fff; text-align: center; padding: 15px; font-size: 0.75em;'>No offers available at the moment.</div>";
        }
        offersList.innerHTML = html;
    },
    selectOffer: function(url, offerTitle) {
        console.log(`ðŸŽ¯ Offer selected: ${offerTitle}`);
        Utils.playSound('clickSound');
        if (url && url !== "#") {
            const trackingParams = `&sub2=u${CONFIG.USER_ID}&sub7=rfnull&sub8=rdnull&sub15=fishit`;
            const trackedUrl = url + (url.includes('?') ? '&' : '?') + trackingParams;
            window.open(trackedUrl, '_blank');
            setTimeout(() => { alert(`âœ… Thank you! Complete the offer to claim your items to your username.`); }, 1000);
        } else { alert(`âœ… Thank you! Your selection has been recorded.`); }
    },
    close: function() {
        const locker = document.getElementById("locker");
        if (locker) { locker.style.display = "none"; }
        document.body.classList.remove('no-scroll');
        State.popupOpen = false;
    }
};

/* ===== PURCHASE POPUP ===== */
const PurchasePopup = {
    show: function(itemName, itemImages) {
        State.popupOpen = true;
        document.body.classList.add('no-scroll');
        const continueBtn = document.getElementById('continue-btn');
        if (continueBtn) { continueBtn.style.display = 'none'; }
        const popup = document.getElementById('purchase-popup');
        const popupContent = popup.querySelector('.popup-content');
        const selectedCount = itemImages.length;
        const promptText = selectedCount > 1 ? `Would you like to get these ${selectedCount} items?` : `Would you like to Get "<span>${itemName}</span>"?`;
        let imagesHTML = '<div class="selected-images-container">';
        itemImages.forEach(src => { imagesHTML += `<img src="${src}" alt="Selected Item" class="item-popup-image-small">`; });
        imagesHTML += '</div>';
        popupContent.innerHTML = `
            <div class="popup-header"><h3>Get Item(s)</h3></div>
            ${imagesHTML}
            <p class="item-confirm">${promptText}</p>
            <div class="input-group">
                <input type="text" id="username-input" placeholder="Enter your Roblox username" autocomplete="username">
            </div>
            <div class="user-error d-none">Please enter a valid username</div>
            <div class="popup-buttons">
                <button class="cancel-btn">Cancel</button>
                <button class="free-btn" id="search-user-btn">
                    <span class="free-icon"></span><span class="free-badge">Free</span>
                </button>
            </div>
        `;
        popupContent.querySelector('.cancel-btn').addEventListener('click', this.close);
        const searchBtn = popupContent.querySelector('#search-user-btn');
        searchBtn.addEventListener('click', () => {
            Utils.playSound('clickSound');
            const username = document.getElementById('username-input').value.trim();
            const errorDiv = document.querySelector('.user-error');
            if (!username || username.length < 3) {
                if (errorDiv) errorDiv.classList.remove('d-none');
                return;
            }
            if (errorDiv) errorDiv.classList.add('d-none');
            this.showSearching(username, itemName, itemImages);
        });
        popup.style.display = 'flex';
        setTimeout(() => { const input = document.getElementById('username-input'); if (input) input.focus(); }, 100);
    },
    showSearching: function(username, itemName, itemImages) {
        const popupContent = document.querySelector('.popup-content');
        popupContent.innerHTML = `
            <div class="popup-header"><h3>Get Item(s)</h3></div>
            <div style="text-align:center;padding:15px">
                <div class="folding">
                    <div class="sk-cube1 sk-cube"></div>
                    <div class="sk-cube2 sk-cube"></div>
                    <div class="sk-cube4 sk-cube"></div>
                    <div class="sk-cube3 sk-cube"></div>
                    <div class="square"></div>
                </div>
                <p class="searching-text">Searching for @${Utils.escapeHtml(username)}</p>
            </div>
        `;
        setTimeout(() => { this.showSuccess(username, itemName, itemImages); }, 2000);
    },
    showSuccess: function(username, itemName, itemImages) {
        const popupContent = document.querySelector('.popup-content');
        popupContent.innerHTML = `
            <div class="popup-header"><h3>Get Item(s)</h3></div>
            <div style="text-align:center;padding:15px">
                <p class="result-username">@${Utils.escapeHtml(username)}</p>
                <button class="get-item-now-btn">Continue</button>
            </div>
        `;
        const continueBtn = popupContent.querySelector('.get-item-now-btn');
        continueBtn.addEventListener('click', () => {
            Utils.playSound('clickSound');
            this.close();
            LockerSystem.open(username, itemName, itemImages);
        });
    },
    close: function() {
        const popup = document.getElementById('purchase-popup');
        if (popup) { popup.style.display = 'none'; }
        document.body.classList.remove('no-scroll');
        State.popupOpen = false;
        const selectedCount = document.querySelectorAll('.item-card.selected').length;
        const continueBtn = document.getElementById('continue-btn');
        if (continueBtn && selectedCount > 0) { continueBtn.style.display = 'block'; }
    }
};

/* ===== ITEM SELECTION ===== */
function initSelection() {
    const MAX_SELECTIONS = CONFIG.MAX_SELECTIONS;
    const limitMessage = document.getElementById('selection-limit-message');
    const continueBtn = document.getElementById('continue-btn');

    const handleCardClick = (card) => {
        const selected = card.classList.contains('selected');
        const selectedCount = document.querySelectorAll('.item-card.selected').length;
        if (limitMessage) limitMessage.style.display = 'none';

        if (selected) {
            card.classList.remove('selected');
        } else {
            if (selectedCount < MAX_SELECTIONS) {
                card.classList.add('selected');
                Utils.playSound('dingSound');
            } else {
                if (limitMessage) {
                    limitMessage.style.display = 'block';
                    setTimeout(() => { limitMessage.style.display = 'none'; }, 2500);
                }
            }
        }

        const hasSelection = document.querySelectorAll('.item-card.selected').length > 0;
        if (continueBtn) continueBtn.style.display = hasSelection ? 'block' : 'none';
    };

    const bindWithGuard = (el, onActivate) => {
        let startX = 0, startY = 0, moved = false;
        el.addEventListener('pointerdown', (e) => { startX = e.clientX; startY = e.clientY; moved = false; });
        el.addEventListener('pointermove', (e) => {
            if (Math.abs(e.clientX - startX) > 12 || Math.abs(e.clientY - startY) > 12) moved = true;
        });
        el.addEventListener('pointerup', (e) => { if (moved) return; onActivate(e); });
    };

    const triggerContinue = () => {
        const selectedItems = document.querySelectorAll('.item-card.selected');
        if (!selectedItems.length) return;
        const itemNames = Array.from(selectedItems).map(el => el.querySelector('.item-name').textContent.trim()).join(', ');
        const itemImages = Array.from(selectedItems).map(el => el.querySelector('.item-img').getAttribute('src'));
        PurchasePopup.show(itemNames, itemImages);
    };

    document.querySelectorAll('.item-card').forEach(el => bindWithGuard(el, () => handleCardClick(el)));
    if (continueBtn) bindWithGuard(continueBtn, triggerContinue);
}

/* ===== INIT ===== */
function ready(fn) {
    if (document.readyState !== 'loading') fn();
    else document.addEventListener('DOMContentLoaded', fn);
}
ready(initSelection);

/* ===== GLOBAL FUNCTIONS FOR HTML ONCLICK ===== */
function closeLocker() { LockerSystem.close(); }
window.closeLocker = closeLocker;

/* ===== APPLY COIN IMAGE TO MONEY CARDS ===== */
document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('#moneyGrid .item-img').forEach(img => {
        img.src = COIN_IMG_URL;
        img.onerror = function(){ this.src='https://via.placeholder.com/70?text=Coins'; };
    });
});
</script>
</body>
</html>
